<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Landing Page Optimizations</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
    </style>
</head>
<body>
    <h1>Landing Page Optimizations Test</h1>
    
    <div class="test-section">
        <h2>1. Database Query Optimization Test</h2>
        <button onclick="testStatsAPI()">Test Stats API</button>
        <div id="statsResult"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Featured Albums API Test</h2>
        <button onclick="testAlbumsAPI()">Test Albums API</button>
        <div id="albumsResult"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Carousel Images API Test</h2>
        <button onclick="testCarouselAPI()">Test Carousel API</button>
        <div id="carouselResult"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Lazy Loading Test</h2>
        <button onclick="testLazyLoading()">Test Lazy Loading</button>
        <div id="lazyResult"></div>
    </div>
    
    <div class="test-section">
        <h2>5. Accessibility Test</h2>
        <button onclick="testAccessibility()">Test Accessibility Features</button>
        <div id="accessibilityResult"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000';
        
        async function testStatsAPI() {
            const resultDiv = document.getElementById('statsResult');
            resultDiv.innerHTML = '<div class="info">Testing stats API...</div>';
            
            try {
                const start = performance.now();
                const response = await fetch(`${API_BASE_URL}/api/landing/stats`);
                const end = performance.now();
                const data = await response.json();
                
                const responseTime = Math.round(end - start);
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">✅ Stats API working correctly</div>
                        <div>Response time: ${responseTime}ms</div>
                        <div>Cache headers: ${response.headers.get('Cache-Control') ? '✅' : '❌'}</div>
                        <div>Data: Users: ${data.totalUsers}, Reviews: ${data.totalReviews}, Albums: ${data.totalAlbums}</div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">❌ Stats API failed: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
            }
        }
        
        async function testAlbumsAPI() {
            const resultDiv = document.getElementById('albumsResult');
            resultDiv.innerHTML = '<div class="info">Testing albums API...</div>';
            
            try {
                const start = performance.now();
                const response = await fetch(`${API_BASE_URL}/api/landing/featured-albums`);
                const end = performance.now();
                const data = await response.json();
                
                const responseTime = Math.round(end - start);
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">✅ Albums API working correctly</div>
                        <div>Response time: ${responseTime}ms</div>
                        <div>Cache headers: ${response.headers.get('Cache-Control') ? '✅' : '❌'}</div>
                        <div>Albums found: ${data.albums.length}</div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">❌ Albums API failed: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
            }
        }
        
        async function testCarouselAPI() {
            const resultDiv = document.getElementById('carouselResult');
            resultDiv.innerHTML = '<div class="info">Testing carousel API...</div>';
            
            try {
                const start = performance.now();
                const response = await fetch(`${API_BASE_URL}/api/landing/carousel-images`);
                const end = performance.now();
                const data = await response.json();
                
                const responseTime = Math.round(end - start);
                
                if (data.success) {
                    const hasThumbails = data.images.some(img => img.thumbnailUrl);
                    resultDiv.innerHTML = `
                        <div class="success">✅ Carousel API working correctly</div>
                        <div>Response time: ${responseTime}ms</div>
                        <div>Cache headers: ${response.headers.get('Cache-Control') ? '✅' : '❌'}</div>
                        <div>Images found: ${data.images.length}</div>
                        <div>Thumbnail URLs: ${hasThumbails ? '✅' : '❌'}</div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error">❌ Carousel API failed: ${data.error}</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">❌ Error: ${error.message}</div>`;
            }
        }
        
        function testLazyLoading() {
            const resultDiv = document.getElementById('lazyResult');
            
            // Test if Intersection Observer is supported
            const hasIntersectionObserver = 'IntersectionObserver' in window;
            
            // Create a test element with lazy loading attributes
            const testElement = document.createElement('div');
            testElement.className = 'carousel-bg-image';
            testElement.setAttribute('data-src', 'test-image.jpg');
            testElement.setAttribute('data-thumbnail', 'test-thumb.jpg');
            testElement.setAttribute('loading', 'lazy');
            
            const hasDataAttributes = testElement.hasAttribute('data-src') && testElement.hasAttribute('data-thumbnail');
            const hasLoadingAttribute = testElement.hasAttribute('loading');
            
            resultDiv.innerHTML = `
                <div class="${hasIntersectionObserver ? 'success' : 'error'}">
                    ${hasIntersectionObserver ? '✅' : '❌'} Intersection Observer support
                </div>
                <div class="${hasDataAttributes ? 'success' : 'error'}">
                    ${hasDataAttributes ? '✅' : '❌'} Data attributes for lazy loading
                </div>
                <div class="${hasLoadingAttribute ? 'success' : 'error'}">
                    ${hasLoadingAttribute ? '✅' : '❌'} Loading attribute support
                </div>
            `;
        }
        
        function testAccessibility() {
            const resultDiv = document.getElementById('accessibilityResult');
            
            // Test for ARIA attributes
            const testButton = document.createElement('button');
            testButton.setAttribute('aria-label', 'Test button');
            testButton.setAttribute('role', 'button');
            testButton.setAttribute('tabindex', '0');
            
            const hasAriaLabel = testButton.hasAttribute('aria-label');
            const hasRole = testButton.hasAttribute('role');
            const hasTabindex = testButton.hasAttribute('tabindex');
            
            // Test for skip link
            const skipLink = document.createElement('a');
            skipLink.href = '#main-content';
            skipLink.className = 'skip-link';
            skipLink.textContent = 'Skip to main content';
            
            // Test for semantic HTML
            const hasSemanticElements = document.createElement('main') && 
                                      document.createElement('section') && 
                                      document.createElement('header');
            
            resultDiv.innerHTML = `
                <div class="${hasAriaLabel ? 'success' : 'error'}">
                    ${hasAriaLabel ? '✅' : '❌'} ARIA labels support
                </div>
                <div class="${hasRole ? 'success' : 'error'}">
                    ${hasRole ? '✅' : '❌'} Role attributes support
                </div>
                <div class="${hasTabindex ? 'success' : 'error'}">
                    ${hasTabindex ? '✅' : '❌'} Tabindex support
                </div>
                <div class="${hasSemanticElements ? 'success' : 'error'}">
                    ${hasSemanticElements ? '✅' : '❌'} Semantic HTML elements
                </div>
                <div class="info">Skip link and keyboard navigation implemented in main HTML</div>
            `;
        }
        
        // Run all tests on page load
        window.addEventListener('load', () => {
            console.log('Landing Page Optimizations Test Page Loaded');
        });
    </script>
</body>
</html>